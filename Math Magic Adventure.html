<!DOCTYPE html>
<html>
<head>
  <title>Math Magic Adventure</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
      position: relative;
    }

    /* Floating bubbles background */
    .bubble {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      animation: float-up 15s infinite linear;
    }

    @keyframes float-up {
      0% { transform: translateY(100vh) translateX(0); }
      100% { transform: translateY(-100px) translateX(100px); }
    }

    /* Header with level selector */
    .header {
      width: 100%;
      background: rgba(255,255,255,0.95);
      padding: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .level-selector {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .level-btn {
      padding: 10px 20px;
      border: 2px solid #fa709a;
      background: white;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }

    .level-btn.active {
      background: #fa709a;
      color: white;
    }

    .score-display {
      font-size: 24px;
      font-weight: bold;
      color: #fa709a;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Main game container */
    .game-container {
      background: rgba(255,255,255,0.95);
      border-radius: 30px;
      padding: 30px;
      margin: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
      max-width: 800px;
      width: 90%;
      animation: gentle-float 4s ease-in-out infinite;
    }

    @keyframes gentle-float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Problem display */
    .problem-display {
      text-align: center;
      margin: 30px 0;
    }

    .problem-text {
      font-size: 48px;
      color: #333;
      margin: 20px 0;
      font-weight: bold;
    }

    /* Visual aids container */
    .visual-aids {
      min-height: 150px;
      margin: 30px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
      padding: 20px;
      background: rgba(250, 112, 154, 0.1);
      border-radius: 20px;
      position: relative;
    }

    /* Draggable items */
    .item {
      width: 60px;
      height: 60px;
      cursor: grab;
      transition: transform 0.2s;
      font-size: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      animation: item-appear 0.5s ease-out;
    }

    .item:hover {
      transform: scale(1.1);
    }

    .item.dragging {
      cursor: grabbing;
      opacity: 0.5;
      transform: scale(1.2);
    }

    @keyframes item-appear {
      0% { transform: scale(0) rotate(180deg); opacity: 0; }
      100% { transform: scale(1) rotate(0); opacity: 1; }
    }

    /* Drop zones */
    .drop-zone {
      border: 3px dashed #fa709a;
      border-radius: 20px;
      min-width: 100px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px;
      background: rgba(250, 112, 154, 0.05);
      transition: all 0.3s;
    }

    .drop-zone.drag-over {
      background: rgba(250, 112, 154, 0.2);
      transform: scale(1.05);
    }

    /* Answer section */
    .answer-section {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .answer-btn {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      color: white;
      border: none;
      padding: 20px 40px;
      border-radius: 50px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      min-width: 100px;
    }

    .answer-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }

    .answer-btn:active {
      transform: translateY(0);
    }

    /* Number line */
    .number-line {
      width: 100%;
      height: 60px;
      position: relative;
      margin: 30px 0;
      background: linear-gradient(to right, #fa709a 0%, #fee140 100%);
      border-radius: 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .number-marker {
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    /* Feedback messages */
    .feedback {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 60px;
      font-weight: bold;
      animation: feedback-pop 1s ease-out;
      pointer-events: none;
      z-index: 1000;
      text-align: center;
    }

    @keyframes feedback-pop {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
      50% { transform: translate(-50%, -50%) scale(1.2) rotate(10deg); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(0) rotate(180deg); opacity: 0; }
    }

    /* Settings panel */
    .settings {
      position: fixed;
      top: 80px;
      right: 10px;
      background: rgba(255,255,255,0.95);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      z-index: 100;
    }

    .setting-item {
      margin: 15px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Progress stars */
    .progress-stars {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .star {
      font-size: 40px;
      color: #ddd;
      transition: all 0.3s;
    }

    .star.earned {
      color: #ffd700;
      animation: star-spin 0.5s ease-out;
    }

    @keyframes star-spin {
      0% { transform: scale(0) rotate(0); }
      100% { transform: scale(1) rotate(360deg); }
    }

    /* Controls */
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    button {
      background: #fa709a;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(0,0,0,0.3);
    }

    /* Manipulatives styles */
    .manipulative {
      width: 50px;
      height: 50px;
      margin: 5px;
      cursor: move;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      transition: transform 0.2s;
    }

    .manipulative:hover {
      transform: scale(1.1);
    }

    /* Ten frame */
    .ten-frame {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-template-rows: repeat(2, 60px);
      gap: 5px;
      margin: 20px auto;
      background: #f0f0f0;
      padding: 10px;
      border-radius: 15px;
    }

    .frame-cell {
      background: white;
      border: 2px solid #fa709a;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .problem-text {
        font-size: 36px;
      }
      
      .answer-btn {
        padding: 15px 25px;
        font-size: 24px;
      }
      
      .item {
        width: 50px;
        height: 50px;
        font-size: 30px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="level-selector">
      <span style="font-weight: bold; margin-right: 10px;">Level:</span>
      <button class="level-btn active" onclick="setLevel('counting')">Counting</button>
      <button class="level-btn" onclick="setLevel('addition')">Addition</button>
      <button class="level-btn" onclick="setLevel('subtraction')">Subtraction</button>
      <button class="level-btn" onclick="setLevel('patterns')">Patterns</button>
    </div>
    <div class="score-display">
      <span>‚≠ê Score:</span>
      <span id="score">0</span>
    </div>
  </div>

  <!-- Main Game Container -->
  <div class="game-container">
    <h1 style="text-align: center; color: #fa709a; margin-bottom: 20px;">
      üéØ Math Magic Adventure üéØ
    </h1>

    <!-- Progress Stars -->
    <div class="progress-stars" id="progressStars">
      <span class="star">‚≠ê</span>
      <span class="star">‚≠ê</span>
      <span class="star">‚≠ê</span>
      <span class="star">‚≠ê</span>
      <span class="star">‚≠ê</span>
    </div>

    <!-- Problem Display -->
    <div class="problem-display">
      <div id="problemText" class="problem-text">How many apples? üçé</div>
    </div>

    <!-- Visual Aids -->
    <div class="visual-aids" id="visualAids">
      <!-- Dynamic content will be inserted here -->
    </div>

    <!-- Answer Section -->
    <div class="answer-section" id="answerSection">
      <!-- Dynamic answer buttons will be inserted here -->
    </div>

    <!-- Controls -->
    <div class="controls">
      <button onclick="newProblem()">üé≤ New Problem</button>
      <button onclick="showHint()">üí° Hint</button>
      <button onclick="playSound()">üîä Read Aloud</button>
    </div>
  </div>

  <!-- Settings Panel -->
  <div class="settings">
    <h3>‚öôÔ∏è Settings</h3>
    <div class="setting-item">
      <label>Sounds:</label>
      <input type="checkbox" id="soundToggle" checked>
    </div>
    <div class="setting-item">
      <label>Visual Effects:</label>
      <input type="checkbox" id="effectsToggle" checked>
    </div>
    <div class="setting-item">
      <label>Number Range:</label>
      <select id="numberRange">
        <option value="5">1-5</option>
        <option value="10" selected>1-10</option>
        <option value="20">1-20</option>
      </select>
    </div>
    <div class="setting-item">
      <label>Timer:</label>
      <input type="checkbox" id="timerToggle">
    </div>
  </div>

  <script>
    // Game state
    let currentLevel = 'counting';
    let score = 0;
    let streak = 0;
    let currentProblem = {};
    let maxNumber = 10;

    // Emoji sets for visual variety
    const emojiSets = {
      fruits: ['üçé', 'üçä', 'üçå', 'üçá', 'üçì', 'üçë', 'üçí', 'ü•ù'],
      animals: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº'],
      toys: ['‚öΩ', 'üèÄ', 'üéà', 'üéØ', 'ü™Å', 'üé®', 'üß∏', 'üéÆ'],
      nature: ['üåü', 'üåô', '‚òÄÔ∏è', 'üåà', 'üå∏', 'üå∫', 'üåª', 'ü¶ã'],
      food: ['üçï', 'üçî', 'üåÆ', 'üç©', 'üßÅ', 'üç™', 'üç¶', 'üç≠']
    };

    // Initialize
    function init() {
      createBubbles();
      updateScore();
      newProblem();
      
      // Set up number range listener
      document.getElementById('numberRange').addEventListener('change', (e) => {
        maxNumber = parseInt(e.target.value);
        newProblem();
      });
    }

    // Create floating bubbles
    function createBubbles() {
      for (let i = 0; i < 15; i++) {
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.style.width = Math.random() * 60 + 20 + 'px';
        bubble.style.height = bubble.style.width;
        bubble.style.left = Math.random() * 100 + '%';
        bubble.style.animationDelay = Math.random() * 15 + 's';
        bubble.style.animationDuration = (Math.random() * 10 + 15) + 's';
        document.body.appendChild(bubble);
      }
    }

    // Set game level
    function setLevel(level) {
      currentLevel = level;
      document.querySelectorAll('.level-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      streak = 0;
      updateProgressStars();
      newProblem();
    }

    // Generate new problem based on level
    function newProblem() {
      const visualAids = document.getElementById('visualAids');
      const answerSection = document.getElementById('answerSection');
      
      visualAids.innerHTML = '';
      answerSection.innerHTML = '';
      
      switch(currentLevel) {
        case 'counting':
          generateCountingProblem();
          break;
        case 'addition':
          generateAdditionProblem();
          break;
        case 'subtraction':
          generateSubtractionProblem();
          break;
        case 'patterns':
          generatePatternProblem();
          break;
      }
    }

    // Counting problems
    function generateCountingProblem() {
      const count = Math.floor(Math.random() * maxNumber) + 1;
      const emojiSet = Object.keys(emojiSets)[Math.floor(Math.random() * Object.keys(emojiSets).length)];
      const emoji = emojiSets[emojiSet][Math.floor(Math.random() * emojiSets[emojiSet].length)];
      
      currentProblem = { answer: count, emoji: emoji };
      
      document.getElementById('problemText').innerHTML = `How many ${emoji}?`;
      
      // Create visual items
      const visualAids = document.getElementById('visualAids');
      for (let i = 0; i < count; i++) {
        const item = document.createElement('div');
        item.className = 'item';
        item.textContent = emoji;
        item.style.animationDelay = i * 0.1 + 's';
        visualAids.appendChild(item);
      }
      
      // Create answer buttons
      createAnswerButtons(count);
    }

    // Addition problems
    function generateAdditionProblem() {
      const num1 = Math.floor(Math.random() * (maxNumber/2)) + 1;
      const num2 = Math.floor(Math.random() * (maxNumber/2)) + 1;
      const answer = num1 + num2;
      
      const emojiSet = Object.keys(emojiSets)[Math.floor(Math.random() * Object.keys(emojiSets).length)];
      const emoji = emojiSets[emojiSet][Math.floor(Math.random() * emojiSets[emojiSet].length)];
      
      currentProblem = { num1, num2, answer, emoji };
      
      document.getElementById('problemText').innerHTML = `${num1} + ${num2} = ?`;
      
      // Create visual representation
      const visualAids = document.getElementById('visualAids');
      
      // First group
      const group1 = document.createElement('div');
      group1.style.display = 'inline-block';
      group1.style.margin = '0 20px';
      group1.style.padding = '10px';
      group1.style.background = 'rgba(250, 112, 154, 0.1)';
      group1.style.borderRadius = '15px';
      
      for (let i = 0; i < num1; i++) {
        const item = document.createElement('div');
        item.className = 'item';
        item.textContent = emoji;
        item.style.display = 'inline-block';
        group1.appendChild(item);
      }
      
      // Plus sign
      const plus = document.createElement('div');
      plus.style.display = 'inline-block';
      plus.style.fontSize = '40px';
      plus.style.margin = '0 20px';
      plus.textContent = '+';
      
      // Second group
      const group2 = document.createElement('div');
      group2.style.display = 'inline-block';
      group2.style.margin = '0 20px';
      group2.style.padding = '10px';
      group2.style.background = 'rgba(254, 225, 64, 0.1)';
      group2.style.borderRadius = '15px';
      
      for (let i = 0; i < num2; i++) {
        const item = document.createElement('div');
        item.className = 'item';
        item.textContent = emoji;
        item.style.display = 'inline-block';
        group2.appendChild(item);
      }
      
      visualAids.appendChild(group1);
      visualAids.appendChild(plus);
      visualAids.appendChild(group2);
      
      createAnswerButtons(answer);
    }

    // Subtraction problems
    function generateSubtractionProblem() {
      const num1 = Math.floor(Math.random() * maxNumber) + 1;
      const num2 = Math.floor(Math.random() * num1) + 1;
      const answer = num1 - num2;
      
      const emojiSet = Object.keys(emojiSets)[Math.floor(Math.random() * Object.keys(emojiSets).length)];
      const emoji = emojiSets[emojiSet][Math.floor(Math.random() * emojiSets[emojiSet].length)];
      
      currentProblem = { num1, num2, answer, emoji };
      
      document.getElementById('problemText').innerHTML = `${num1} - ${num2} = ?`;
      
      // Create visual representation with crossing out
      const visualAids = document.getElementById('visualAids');
      
      for (let i = 0; i < num1; i++) {
        const item = document.createElement('div');
        item.className = 'item';
        item.textContent = emoji;
        
        if (i < num2) {
          item.style.opacity = '0.3';
          item.style.textDecoration = 'line-through';
          item.style.textDecorationColor = 'red';
          item.style.textDecorationThickness = '3px';
        }
        
        visualAids.appendChild(item);
      }
      
      createAnswerButtons(answer);
    }

    // Pattern problems
    function generatePatternProblem() {
      const patterns = [
        { type: 'simple', emojis: ['üî¥', 'üîµ', 'üî¥', 'üîµ', 'üî¥'], answer: 'üîµ' },
        { type: 'simple', emojis: ['‚≠ê', '‚≠ê', 'üåô', '‚≠ê', '‚≠ê'], answer: 'üåô' },
        { type: 'complex', emojis: ['üçé', 'üçä', 'üçå', 'üçé', 'üçä'], answer: 'üçå' },
        { type: 'number', emojis: ['1Ô∏è‚É£', '2Ô∏è‚É£', '3Ô∏è‚É£', '4Ô∏è‚É£', '5Ô∏è‚É£'], answer: '6Ô∏è‚É£' }
      ];
      
      const pattern = patterns[Math.floor(Math.random() * patterns.length)];
      currentProblem = { answer: pattern.answer };
      
      document.getElementById('problemText').innerHTML = 'What comes next?';
      
      // Display pattern
      const visualAids = document.getElementById('visualAids');
      pattern.emojis.forEach((emoji, index) => {
        const item = document.createElement('div');
        item.className = 'item';
        item.textContent = emoji;
        item.style.animationDelay = index * 0.1 + 's';
        visualAids.appendChild(item);
      });
      
      // Add question mark
      const question = document.createElement('div');
      question.className = 'item';
      question.textContent = '‚ùì';
      question.style.border = '3px dashed #fa709a';
      question.style.borderRadius = '15px';
      visualAids.appendChild(question);
      
      // Create pattern answer buttons
      const answerSection = document.getElementById('answerSection');
      const options = [pattern.answer];
      
      // Add wrong options
      const allEmojis = ['üî¥', 'üîµ', 'üü°', 'üü¢', '‚≠ê', 'üåô', '‚òÄÔ∏è', 'üçé', 'üçä', 'üçå', 'üçá'];
      while (options.length < 4) {
        const wrongOption = allEmojis[Math.floor(Math.random() * allEmojis.length)];
        if (!options.includes(wrongOption)) {
          options.push(wrongOption);
        }
      }
      
      // Shuffle options
      options.sort(() => Math.random() - 0.5);
      
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(option);
        answerSection.appendChild(btn);
      });
    }

    // Create answer buttons
    function createAnswerButtons(correctAnswer) {
      const answerSection = document.getElementById('answerSection');
      const options = [correctAnswer];
      
      // Generate wrong answers
      while (options.length < 4) {
        let wrongAnswer;
        if (currentLevel === 'counting' || currentLevel === 'addition') {
          wrongAnswer = Math.floor(Math.random() * (maxNumber + 5)) + 1;
        } else {
          wrongAnswer = Math.max(0, correctAnswer + Math.floor(Math.random() * 5) - 2);
        }
        
        if (!options.includes(wrongAnswer) && wrongAnswer !== correctAnswer) {
          options.push(wrongAnswer);
        }
      }
      
      // Shuffle options
      options.sort(() => Math.random() - 0.5);
      
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'answer-btn';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(option);
        answerSection.appendChild(btn);
      });
    }

    // Check answer
    function checkAnswer(answer) {
      const isCorrect = answer == currentProblem.answer;
      
      if (isCorrect) {
        streak++;
        score += 10 * Math.min(streak, 5);
        showFeedback('üéâ Correct! üéâ', '#4CAF50');
        updateProgressStars();
        
        if (document.getElementById('soundToggle').checked) {
          playSuccessSound();
        }
        
        setTimeout(() => newProblem(), 1500);
      } else {
        streak = 0;
        showFeedback('Try Again! üí™', '#FF6B6B');
        updateProgressStars();
        
        if (document.getElementById('soundToggle').checked) {
          playTryAgainSound();
        }
      }
      
      updateScore();
    }

    // Show feedback
    function showFeedback(message, color) {
      const feedback = document.createElement('div');
      feedback.className = 'feedback';
      feedback.textContent = message;
      feedback.style.color = color;
      document.body.appendChild(feedback);
      
      setTimeout(() => feedback.remove(), 1000);
      
      if (document.getElementById('effectsToggle').checked && message.includes('Correct')) {
        createConfetti();
      }
    }

    // Create confetti effect
    function createConfetti() {
      const colors = ['#fa709a', '#fee140', '#4CAF50', '#2196F3', '#FF6B6B'];
      
      for (let i = 0; i < 30; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.style.position = 'fixed';
          confetti.style.width = '10px';
          confetti.style.height = '10px';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.top = '-20px';
          confetti.style.borderRadius = '50%';
          confetti.style.pointerEvents = 'none';
          confetti.style.zIndex = '1000';
          
          document.body.appendChild(confetti);
          
          const animation = confetti.animate([
            { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
            { transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random() * 720 - 360}deg)`, opacity: 0 }
          ], {
            duration: Math.random() * 2000 + 1000,
            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
          });
          
          animation.onfinish = () => confetti.remove();
        }, i * 50);
      }
    }

    // Update score
    function updateScore() {
      document.getElementById('score').textContent = score;
    }

    // Update progress stars
    function updateProgressStars() {
      const stars = document.querySelectorAll('.progress-stars .star');
      stars.forEach((star, index) => {
        if (index < streak) {
          star.classList.add('earned');
        } else {
          star.classList.remove('earned');
        }
      });
    }

    // Show hint
    function showHint() {
      const visualAids = document.getElementById('visualAids');
      visualAids.style.animation = 'pulse 1s ease-in-out 3';
      
      setTimeout(() => {
        visualAids.style.animation = '';
      }, 3000);
      